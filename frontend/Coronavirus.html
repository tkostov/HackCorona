<html>
  <head>
    <title>Corona Tracker - Test HeatMap</title>
    <meta charset="utf-8" />
    <link
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
      integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link
      href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css"
      rel="stylesheet"
    />

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>

    <!-- LEAFLET part -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
      integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
      integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
      crossorigin=""
    ></script>

    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    <script src="leaflet-easybutton_2.4.0.js"></script>
    <script type="text/javascript" src="points.js"></script>
    <script type="text/javascript" src="hospitals.js"></script>
    <script type="text/javascript" src="supermarkets.js"></script>
    <link href="leaflet-easybutton_2.4.0.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>

    <style></style>
  </head>

  <body>
    <div id="settings">
      <div class="container fill">
        <div class="row">
          <div class="col-md-12*">
            <h3>COVID - 19 Simulation</h3>
            <hr />
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <p>
              Landjaeger prosciutto flank andouille bresaola, strip steak ball
              tip. Doner meatloaf shankle, shoulder t-bone fatback brisket
              sausage. Buffalo landjaeger beef ribs rump shankle. Chuck sirloin
              cupim tri-tip pork belly pork loin fatback leberkas.
            </p>
            <hr />
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <h4>Einstellungen</h4>
            <p>hier eine kurze Beschreibung</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <button type="button" class="btn btn-secondary">Infizierte</button>
          </div>
          <div class="col-md-6">
            <button type="button" class="btn btn-secondary">Verstorben</button>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12"><p>hier eine kurze Beschreibung</p></div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <button type="button" class="btn btn-secondary">
              Normalisiert
            </button>
          </div>
          <div class="col-md-6">
            <button type="button" class="btn btn-secondary">Real</button>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <p>Bewege den Slider um die nächsten Tage zu simulieren.</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="slidecontainer">
              <input
                type="range"
                min="1"
                max="100"
                value="50"
                class="slider"
                id="rangeDays"
              />
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <p>
              Wähle folgende Optionen aus um die Ausbreitung zu verlangsamen.
            </p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <input type="checkbox" id="vehicle1" name="vehicle1" value="Bike" />
            <label for="vehicle1"> Ausgangssperre</label>
          </div>
        </div>
        <div class="row align-to-bottom">
          <div class="col-md-12">
            <div class="div-wrapper">
              <img style="width:100%;" src="images/wirvsvirus.jpg" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="map" />

    <script>
      var debug = true;

      var heatmap = null;
      function showHeatmap(heatdata, maxValue) {
        if (heatmap == null) {
          heatmap = L.heatLayer(heatdata, {
            radius: 50,
            max: maxValue,
            blur: 50,
            gradient: { 0.0: "blue", 0.5: "lime", 1: "red" }
          }).addTo(map);
        } else {
          heatmap.removeFrom(map);
          heatmap = null;
        }

        return heatmap;
      }

      function onMapClick(e) {
        console.log("[" + e.latlng.lat + "," + e.latlng.lng + "]");
      }

      var map;

      function loadMap(id, zoomLevel) {
        map = L.map("map").setView([50.64028, 9.898626], zoomLevel);
        L.tileLayer(
          "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",
          {
            maxZoom: 15,
            minZoom: 5,
            attribution:
              'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
              '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
              'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            id: "mapbox.light"
          }
        ).addTo(map);
      }

      var maxValue = getMax(points);

      function getMax(p) {
        var max = 0;
        for (var i = 0; i < p.length; i++) {
          var v = p[i][2];
          if (max < v) max = v;
        }
        logText("Max = " + max);
        return max;
      }

      var hList;
      function showHospitals() {
        if (hList == null) {
          hList = [];
          for (var i = 0; i < hospitals.length; i++) {
            var h = hospitals[i];
            var circle = L.circle([h[1], h[2]], {
              color: "red",
              fillColor: "#f03",
              fillOpacity: 0.5,
              radius: 300
            }).addTo(map);

            circle.bindPopup(h[0]);

            hList.push(circle);
          }
        } else {
          for (var i = 0; i < hList.length; i++) {
            var h = hList[i];
            h.removeFrom(map);
          }
          hList = null;
        }
      }

      /*var sList;
function showSuperMarkets() {

if (sList == null) {
   sList = [];
	for(var i = 0; i < supermarkets.length; i++){
	   var h = supermarkets[i];
		var circle = L.circle([h[1], h[2]], {
		color: 'green',
		fillColor: 'lightgray',
		fillOpacity: 0.5,
		radius: 300
	   }).addTo(map);
	   
	   circle.bindPopup(h[0]);
	   
	   sList.push(circle);
	}
	}
else {
	for(var i = 0; i < sList.length; i++){
	   var s = sList[i];
	   s.removeFrom(map);
     }
	 sList = null;
	}	
} */

      function heatmapFunction() {
        if (heatmap == null) {
          showHeatmap(points, maxValue);
        } else {
          showHeatmap([]);
        }
      }

      function prepareButtons(mobile) {
        map.addControl(
          new L.Control.Fullscreen({
            title: {
              false: "Vollbild anzeigen",
              true: "Vollbildmodus beenden"
            }
          })
        );

        L.easyButton("fa-map", heatmapFunction, "Heatmap anzeigen").addTo(map);
        L.easyButton("fa-flag", showHospitals, "Krankenhäuser anzeigen").addTo(
          map
        );
        // L.easyButton( 'fa-flag', showSuperMarkets, "Supermarkets anzeigen").addTo(map);
      }

      function logText(v) {
        if (debug) console.log(v);
      }

      function onMapClick(e) {
        logText("[" + e.latlng.lat + "," + e.latlng.lng + "]");
      }
    </script>

    <script>
      var sm = document.getElementById("map");
      sm.style.height = "100%";
      sm.style.width = "80%";

      loadMap("map", 7);
      prepareButtons();
      map.on("click", this.onMapClick);
    </script>
  </body>
</html>
